<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gest√£o H√≠drica - Base Naval & Lespan</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üíß</text></svg>">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --navy-primary: #0a2342;
            --navy-secondary: #2ca58d;
            --money-color: #198754;
            --lespan-color: #e56b6f;
            --bg-color: #f0f2f5;
        }
        body { background-color: var(--bg-color); font-family: 'Segoe UI', Roboto, sans-serif; }
        .card { border: none; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .card-header { background-color: white; border-bottom: 1px solid #eee; font-weight: 700; color: var(--navy-primary); padding: 15px; border-radius: 12px 12px 0 0 !important; }
        .nav-pills .nav-link { color: var(--navy-primary); font-weight: 600; margin-right: 10px; background: white; border: 1px solid #e9ecef; }
        .nav-pills .nav-link.active { background-color: var(--navy-primary); color: white; border-color: var(--navy-primary); }
        .kpi-value { font-size: 1.8rem; font-weight: 800; color: var(--navy-primary); }
        .money-text { color: var(--money-color); }
        .trend-up { color: #dc3545; font-weight: bold; }
        .trend-down { color: #198754; font-weight: bold; }
        
        /* Estilo da √Årea Admin */
        .admin-panel { background-color: #fff3cd; border: 2px dashed #ffc107; }
        .code-block { background: #2d2d2d; color: #00ff00; font-family: monospace; padding: 15px; border-radius: 5px; max-height: 200px; overflow-y: auto; }
    </style>
</head>
<body>

<div class="container py-4">
    
    <!-- Cabe√ßalho -->
    <div class="d-flex flex-wrap justify-content-between align-items-center mb-4 gap-3">
        <div>
            <h2 class="fw-bold mb-0" style="color: var(--navy-primary);"><i class="fa-solid fa-faucet-drip me-2"></i>Gest√£o H√≠drica</h2>
            <p class="text-muted mb-0">Monitoramento Integrado</p>
        </div>
        <div class="d-flex gap-2">
            <div class="bg-white p-2 rounded border d-flex align-items-center">
                <label class="fw-bold text-muted me-2 small">ANO:</label>
                <select id="yearSelect" class="form-select form-select-sm fw-bold border-0 bg-light" style="width: 80px;" onchange="updateUI()">
                    <option value="2025">2025</option>
                    <option value="2024">2024</option>
                </select>
            </div>
            <button class="btn btn-outline-dark" onclick="openAdmin()"><i class="fa-solid fa-lock"></i> Admin</button>
        </div>
    </div>

    <!-- KPIs -->
    <div class="row g-3 mb-4">
        <div class="col-md-3">
            <div class="card p-3 h-100 border-start border-5 border-primary">
                <div class="kpi-label text-muted small fw-bold">CONSUMO TOTAL</div>
                <div class="kpi-value" id="kpiVol">0</div>
                <small class="text-muted">Metros C√∫bicos (m¬≥)</small>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card p-3 h-100 border-start border-5 border-success">
                <div class="kpi-label text-muted small fw-bold">CUSTO TOTAL</div>
                <div class="kpi-value money-text" id="kpiCost">R$ 0,00</div>
                <small class="text-muted">Valor Acumulado</small>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card p-3 h-100 border-start border-5 border-warning">
                <div class="kpi-label text-muted small fw-bold">PRE√áO M√âDIO</div>
                <div class="kpi-value text-warning" id="kpiAvg">R$ 0,00</div>
                <small class="text-muted">Por m¬≥ consumido</small>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card p-3 h-100 border-start border-5 border-danger">
                <div class="kpi-label text-muted small fw-bold">MAIOR FATURA</div>
                <div class="kpi-value text-danger" style="font-size: 1.6rem;" id="kpiMax">R$ 0,00</div>
                <small class="text-muted" id="kpiMaxMonth">-</small>
            </div>
        </div>
    </div>

    <!-- Menu de Abas -->
    <ul class="nav nav-pills mb-4" id="pills-tab" role="tablist">
        <li class="nav-item"><button class="nav-link active" data-bs-toggle="pill" data-bs-target="#tab-dash">üìä Dashboard</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#tab-2025">2025 Detalhado</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#tab-2024">2024 Detalhado</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#tab-comp">‚öñÔ∏è Comparativo</button></li>
        <!-- Aba Admin Oculta (aparece via JS) -->
        <li class="nav-item d-none" id="admin-tab-li"><button class="nav-link bg-warning text-dark" data-bs-toggle="pill" data-bs-target="#tab-admin">üîí Inserir Fatura</button></li>
    </ul>

    <div class="tab-content">
        
        <!-- ABA DASHBOARD -->
        <div class="tab-pane fade show active" id="tab-dash">
            <div class="card mb-4">
                <div class="card-header">An√°lise: Consumo Real (m¬≥) vs Custo (R$)</div>
                <div class="card-body">
                    <canvas id="chartFinance" height="80"></canvas>
                </div>
            </div>
            <div class="row">
                <div class="col-md-8">
                    <div class="card h-100">
                        <div class="card-header">Volume por Unidade</div>
                        <div class="card-body"><canvas id="chartVolume" height="150"></canvas></div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100">
                        <div class="card-header">Resumo</div>
                        <div class="card-body">
                            <div class="alert alert-info small">
                                <strong>Dica:</strong> Use o bot√£o "Admin" no topo para gerar o c√≥digo de atualiza√ß√£o quando chegar uma nova fatura.
                            </div>
                            <ul class="list-group list-group-flush" id="statusList"></ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ABA 2025 -->
        <div class="tab-pane fade" id="tab-2025">
            <div class="card">
                <div class="card-header bg-primary text-white">Faturas de 2025</div>
                <div class="card-body table-responsive p-0">
                    <table class="table table-striped table-hover mb-0 align-middle text-center">
                        <thead class="table-dark"><tr><th>M√™s</th><th>Base Naval (m¬≥)</th><th>Lespan (m¬≥)</th><th>Total (m¬≥)</th><th>Valor (R$)</th></tr></thead>
                        <tbody id="tbody2025"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ABA 2024 -->
        <div class="tab-pane fade" id="tab-2024">
            <div class="card">
                <div class="card-header">Hist√≥rico 2024</div>
                <div class="card-body table-responsive p-0">
                    <table class="table table-striped table-hover mb-0 align-middle text-center">
                        <thead class="table-dark"><tr><th>M√™s</th><th>Base Naval (m¬≥)</th><th>Lespan (m¬≥)</th><th>Total (m¬≥)</th><th>Valor (R$)</th></tr></thead>
                        <tbody id="tbody2024"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ABA COMPARATIVO -->
        <div class="tab-pane fade" id="tab-comp">
            <div class="row mb-4">
                <div class="col-md-6"><div class="card"><div class="card-header">Comparativo Volume (m¬≥)</div><div class="card-body"><canvas id="chartCompVol" height="150"></canvas></div></div></div>
                <div class="col-md-6"><div class="card"><div class="card-header">Comparativo Financeiro (R$)</div><div class="card-body"><canvas id="chartCompFin" height="150"></canvas></div></div></div>
            </div>
            <div class="card">
                <div class="card-header">Tabela de Varia√ß√£o</div>
                <div class="card-body table-responsive p-0">
                    <table class="table table-bordered text-center mb-0">
                        <thead class="table-light"><tr><th>M√™s</th><th>m¬≥ 2024</th><th>m¬≥ 2025</th><th>Var. Vol</th><th>R$ 2024</th><th>R$ 2025</th><th>Var. R$</th></tr></thead>
                        <tbody id="tbodyComp"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ABA ADMIN (GERADOR DE C√ìDIGO) -->
        <div class="tab-pane fade" id="tab-admin">
            <div class="card admin-panel">
                <div class="card-header bg-warning text-dark">
                    <i class="fa-solid fa-wand-magic-sparkles"></i> Gerador de Atualiza√ß√£o de Fatura
                </div>
                <div class="card-body">
                    <p class="small">Como o site √© hospedado gratuitamente no GitHub Pages (est√°tico), ele n√£o salva dados automaticamente. Use este formul√°rio para <strong>gerar o c√≥digo</strong> da nova fatura e cole-o no arquivo <code>index.html</code> no GitHub.</p>
                    
                    <div class="row g-3">
                        <div class="col-md-3">
                            <label class="form-label fw-bold">Unidade</label>
                            <select id="admUnit" class="form-select">
                                <option value="baseNaval">Base Naval (Soma Hidr√¥metros)</option>
                                <option value="lespan">Lespan Clube</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label fw-bold">M√™s (2025)</label>
                            <select id="admMonth" class="form-select">
                                <option value="0">Janeiro</option> <option value="1">Fevereiro</option> <option value="2">Mar√ßo</option>
                                <option value="3">Abril</option> <option value="4">Maio</option> <option value="5">Junho</option>
                                <option value="6">Julho</option> <option value="7">Agosto</option> <option value="8">Setembro</option>
                                <option value="9">Outubro</option> <option value="10">Novembro</option> <option value="11">Dezembro</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label fw-bold">Consumo (m¬≥)</label>
                            <input type="number" id="admVol" class="form-control" placeholder="Ex: 15000">
                        </div>
                        <div class="col-md-3 d-flex align-items-end">
                            <button class="btn btn-dark w-100" onclick="generateCode()">Gerar C√≥digo</button>
                        </div>
                        
                        <div class="col-md-12 mt-3">
                            <label class="form-label fw-bold">Adicionar Valor Financeiro (R$)</label>
                            <div class="input-group mb-3">
                                <span class="input-group-text">R$</span>
                                <input type="number" id="admCost" class="form-control" placeholder="Ex: 50000.00">
                                <button class="btn btn-success" onclick="generateFinanceCode()">Gerar Custo</button>
                            </div>
                        </div>
                    </div>

                    <hr>
                    
                    <div id="outputArea" class="d-none">
                        <h5 class="fw-bold text-success">1. Copie o c√≥digo abaixo:</h5>
                        <div class="code-block" id="codeOutput"></div>
                        
                        <h5 class="fw-bold mt-3 text-primary">2. Onde colar?</h5>
                        <p>V√° no GitHub, edite o arquivo <code>index.html</code>, des√ßa at√© o final (nas linhas de <code>const dataVol</code> ou <code>const dataFin</code>) e substitua a linha inteira correspondente.</p>
                    </div>

                </div>
            </div>
        </div>

    </div>
</div>

<!-- Modal de Login -->
<div class="modal fade" id="loginModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Acesso Restrito</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input type="password" id="adminPass" class="form-control text-center" placeholder="Digite a senha">
                <div id="loginMsg" class="text-danger mt-2 text-center small"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary w-100" onclick="checkLogin()">Entrar</button>
            </div>
        </div>
    </div>
</div>

<script>
    // =====================================================
    // BASE DE DADOS (Aqui ficam os dados reais)
    // =====================================================
    
    const months = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];

    // DADOS DE VOLUME (m¬≥) - Base Naval e Lespan
    const dataVol = {
        baseNaval: {
            2024: [39599, 41471, 38758, 40874, 39625, 33576, 32257, 29161, 30129, 37508, 24498, 28735],
            2025: [29523, 31152, 31525, 35663, 33971, 28708, 31069, 31039, 30794, 37508, 0, 0]
        },
        lespan: {
            2024: [171, 81, 124, 111, 217, 54, 111, 287, 153, 153, 166, 254],
            2025: [103, 133, 324, 352, 417, 555, 763, 567, 706, 153, 0, 0]
        }
    };

    // DADOS FINANCEIROS (R$)
    const dataFin = {
        2024: [1309686, 1286805, 1306085, 1392186, 1263393, 1120495, 1075082, 981056, 1004037, 1254901, 821544, 1084810],
        2025: [1113089, 1175472, 1196680, 1353333, 1292153, 1080406, 1196040, 874621, 1355213, 1225487, 0, 0]
    };

    // Vari√°veis dos gr√°ficos
    let chVol, chFin, chCmpVol, chCmpFin;
    const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));

    // =====================================================
    // L√ìGICA DE INTERFACE E GR√ÅFICOS
    // =====================================================

    document.addEventListener('DOMContentLoaded', () => {
        updateUI();
        renderTables();
    });

    function updateUI() {
        const year = document.getElementById('yearSelect').value;
        
        // C√°lculo de KPIs
        const volsBN = dataVol.baseNaval[year];
        const volsLP = dataVol.lespan[year];
        const costs = dataFin[year];
        
        let sumVol = 0, sumCost = 0, maxCost = 0, maxIdx = 0;
        let filledCount = 0;

        for(let i=0; i<12; i++) {
            const v = (volsBN[i] || 0) + (volsLP[i] || 0);
            const c = (costs[i] || 0);
            sumVol += v;
            sumCost += c;
            if(c > maxCost) { maxCost = c; maxIdx = i; }
            if(v > 0) filledCount++;
        }

        const avgPrice = sumVol > 0 ? (sumCost / sumVol) : 0;

        // Atualizar Cards
        animateVal('kpiVol', sumVol, '');
        animateVal('kpiCost', sumCost, 'R$', true);
        animateVal('kpiAvg', avgPrice, 'R$', true);
        document.getElementById('kpiMax').innerText = maxCost.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
        document.getElementById('kpiMaxMonth').innerText = maxCost > 0 ? months[maxIdx] : '-';
        
        // Atualizar Lista Status
        document.getElementById('statusList').innerHTML = `
            <li class="list-group-item d-flex justify-content-between"><span>Dados preenchidos</span> <strong>${filledCount}/12 meses</strong></li>
            <li class="list-group-item d-flex justify-content-between"><span>Ano Refer√™ncia</span> <strong>${year}</strong></li>
        `;

        renderCharts(year);
    }

    function animateVal(id, val, prefix, isCurrency = false) {
        const el = document.getElementById(id);
        if(isCurrency) el.innerText = val.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
        else el.innerText = val.toLocaleString('pt-BR');
    }

    function renderCharts(year) {
        const volsBN = dataVol.baseNaval[year];
        const volsLP = dataVol.lespan[year];
        const costs = dataFin[year];
        
        // Filtra dados futuros (zeros) para gr√°ficos de linha ficarem bonitos
        const cleanData = (arr) => arr.map((v, i) => (year === '2025' && v === 0 && i > 9) ? null : v); 
        
        const totalVol = volsBN.map((v, i) => v + (volsLP[i] || 0));

        // 1. Volume
        if(chVol) chVol.destroy();
        chVol = new Chart(document.getElementById('chartVolume'), {
            type: 'bar',
            data: {
                labels: months,
                datasets: [
                    { label: 'Base Naval', data: volsBN, backgroundColor: '#0a2342' },
                    { label: 'Lespan', data: volsLP, backgroundColor: '#e56b6f' }
                ]
            },
            options: { responsive: true, scales: { x: { stacked: true }, y: { stacked: true } } }
        });

        // 2. Financeiro
        if(chFin) chFin.destroy();
        chFin = new Chart(document.getElementById('chartFinance'), {
            type: 'bar',
            data: {
                labels: months,
                datasets: [
                    { label: 'Custo (R$)', data: cleanData(costs), type: 'line', borderColor: '#198754', backgroundColor: 'rgba(25,135,84,0.1)', yAxisID: 'y1', tension: 0.3 },
                    { label: 'Volume (m¬≥)', data: cleanData(totalVol), backgroundColor: 'rgba(13,110,253,0.4)', yAxisID: 'y' }
                ]
            },
            options: {
                responsive: true,
                scales: {
                    y: { position: 'left', display: false },
                    y1: { position: 'right', grid: { drawOnChartArea: false } }
                }
            }
        });

        // 3. Comparativo
        const vol24 = dataVol.baseNaval[2024].map((v, i) => v + dataVol.lespan[2024][i]);
        const vol25 = dataVol.baseNaval[2025].map((v, i) => v + dataVol.lespan[2025][i]);
        
        if(chCmpVol) chCmpVol.destroy();
        chCmpVol = new Chart(document.getElementById('chartCompVol'), {
            type: 'line',
            data: {
                labels: months,
                datasets: [
                    { label: '2024', data: vol24, borderColor: '#adb5bd', borderDash: [5,5] },
                    { label: '2025', data: cleanData(vol25), borderColor: '#0a2342', borderWidth: 3 }
                ]
            }
        });

        if(chCmpFin) chCmpFin.destroy();
        chCmpFin = new Chart(document.getElementById('chartCompFin'), {
            type: 'bar',
            data: {
                labels: months,
                datasets: [
                    { label: '2024', data: dataFin[2024], backgroundColor: '#adb5bd' },
                    { label: '2025', data: dataFin[2025], backgroundColor: '#198754' }
                ]
            }
        });
    }

    function renderTables() {
        const t25 = document.getElementById('tbody2025');
        const t24 = document.getElementById('tbody2024');
        const tComp = document.getElementById('tbodyComp');
        
        let h25='', h24='', hComp='';

        for(let i=0; i<12; i++) {
            // 2025
            let bn25 = dataVol.baseNaval[2025][i] || 0;
            let lp25 = dataVol.lespan[2025][i] || 0;
            let c25 = dataFin[2025][i] || 0;
            h25 += `<tr><td>${months[i]}</td><td>${bn25 || '-'}</td><td>${lp25 || '-'}</td><td class="fw-bold text-primary">${(bn25+lp25) || '-'}</td><td class="fw-bold text-success">${c25 ? c25.toLocaleString('pt-BR',{style:'currency',currency:'BRL'}) : '-'}</td></tr>`;

            // 2024
            let bn24 = dataVol.baseNaval[2024][i];
            let lp24 = dataVol.lespan[2024][i];
            let c24 = dataFin[2024][i];
            h24 += `<tr><td>${months[i]}</td><td>${bn24}</td><td>${lp24}</td><td class="fw-bold text-primary">${bn24+lp24}</td><td class="fw-bold text-success">${c24.toLocaleString('pt-BR',{style:'currency',currency:'BRL'})}</td></tr>`;
        
            // Comp
            let tot25 = bn25 + lp25;
            let tot24 = bn24 + lp24;
            let varVol = (tot25 > 0) ? ((tot25-tot24)/tot24)*100 : 0;
            let varCost = (c25 > 0) ? ((c25-c24)/c24)*100 : 0;
            
            let volArrow = tot25 > 0 ? (varVol>0 ? '‚ñ≤' : '‚ñº') : '-';
            let costArrow = c25 > 0 ? (varCost>0 ? '‚ñ≤' : '‚ñº') : '-';
            let classVol = varVol > 0 ? 'trend-up' : 'trend-down';
            let classCost = varCost > 0 ? 'trend-up' : 'trend-down';

            hComp += `<tr>
                <td>${months[i]}</td>
                <td>${tot24}</td><td>${tot25 || '-'}</td>
                <td class="${classVol}">${tot25>0 ? volArrow + ' ' + Math.abs(varVol).toFixed(1)+'%' : '-'}</td>
                <td>${c24.toLocaleString('pt-BR',{minimumFractionDigits:0})}</td>
                <td>${c25>0 ? c25.toLocaleString('pt-BR',{minimumFractionDigits:0}) : '-'}</td>
                <td class="${classCost}">${c25>0 ? costArrow + ' ' + Math.abs(varCost).toFixed(1)+'%' : '-'}</td>
            </tr>`;
        }

        t25.innerHTML = h25;
        t24.innerHTML = h24;
        tComp.innerHTML = hComp;
    }

    // =====================================================
    // FUN√á√ïES DE ADMINISTRA√á√ÉO (GERADOR DE C√ìDIGO)
    // =====================================================
    
    function openAdmin() { loginModal.show(); }
    
    function checkLogin() {
        const pass = document.getElementById('adminPass').value;
        if(pass === 'agua2025') { // SENHA SIMPLES
            loginModal.hide();
            document.getElementById('admin-tab-li').classList.remove('d-none');
            const triggerEl = document.querySelector('#pills-tab button[data-bs-target="#tab-admin"]');
            bootstrap.Tab.getOrCreateInstance(triggerEl).show();
        } else {
            document.getElementById('loginMsg').innerText = "Senha incorreta!";
        }
    }

    function generateCode() {
        const unit = document.getElementById('admUnit').value;
        const monthIdx = parseInt(document.getElementById('admMonth').value);
        const newVal = parseInt(document.getElementById('admVol').value);

        if(!newVal) { alert("Digite um valor!"); return; }

        // Clona o array atual
        let arr = [...dataVol[unit][2025]];
        // Atualiza o valor
        arr[monthIdx] = newVal;

        const output = `// Substitua a linha da ${unit} em 2025 por esta:\n` + 
                       `2025: [${arr.join(', ')}]`;
        
        showOutput(output);
    }

    function generateFinanceCode() {
        const monthIdx = parseInt(document.getElementById('admMonth').value);
        const newVal = parseFloat(document.getElementById('admCost').value);

        if(!newVal) { alert("Digite um valor!"); return; }

        let arr = [...dataFin[2025]];
        arr[monthIdx] = newVal;

        const output = `// Substitua a linha de dataFin 2025 por esta:\n` +
                       `2025: [${arr.join(', ')}]`;
        
        showOutput(output);
    }

    function showOutput(text) {
        const div = document.getElementById('outputArea');
        const pre = document.getElementById('codeOutput');
        div.classList.remove('d-none');
        pre.innerText = text;
    }

</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
